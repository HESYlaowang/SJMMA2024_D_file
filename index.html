<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>自动驾驶责任判定</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition-duration: .2s;
        }

        body {
            font-family: Arial, sans-serif;
            background-image: url("https://lspgal.us/wp-content/uploads/20181413725.jpg");
            background-size: cover;
            background-repeat: no-repeat;
            background-position: top;
        }

        #dataForm {
            width: 50vw;
            margin-top: 5vh;
            padding: 16px;
            border-radius: 8px;
            background: #fafafa;
            box-shadow: 4px 4px 8px #0000004d, 
                        -4px -4px 8px #ffffff4d;
        } #dataForm:hover {
            box-shadow: 6px 6px 12px #0000003d, 
                        -4px -4px 8px #ffffff3d;
        }

        .block {
            display: block;
            margin: 8px;
        }

        label {
            margin: 8px 16px 0 16px;
        }

        input[type="text"] {
            padding: 4px 8px;
            border-radius: 5px;
            border: none;
            margin-right: 8px;
            box-shadow: inset 2px 2px 6px #0000004d, 
                        inset -2px -2px 6px #ffffff4d;
        } input[type="text"]:focus {
            outline: none;
            box-shadow: inset 2px 2px 6px #00000080, 
                        inset -2px -2px 6px #ffffff80;
        }

        select {
            padding: 4px 8px;
            border-radius: 5px;
            border: none;
            margin-right: 8px;
            box-shadow: inset 2px 2px 6px #0000004d, 
                        inset -2px -2px 6px #ffffff4d;
        } select:focus {
            outline: none;
            box-shadow: inset 2px 2px 6px #00000080, 
                        inset -2px -2px 6px #ffffff80;
        }

        button {
            margin: 8px 16px 16px 16px;
            padding: 6px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: inset 2px 2px 6px #0000004d, 
                        inset -2px -2px 6px #ffffff4d;
        } button:hover {
            outline: none;
            box-shadow: inset 2px 2px 6px #00000080, 
                        inset -2px -2px 6px #ffffff80;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        #result {
            width: 50vw;
            margin-top: 16px;
            padding: 16px;
            background: #fafafa;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 4px 4px 8px #0000004d, 
                        -4px -4px 8px #ffffff4d;
        } #result:hover {
            box-shadow: 6px 6px 12px #0000003d, 
                        -4px -4px 8px #ffffff3d;
        }
        #result1 {
            width: 50vw;
            margin-top: 16px;
            padding: 16px;
            background: #fafafa;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 4px 4px 8px #0000004d, 
                        -4px -4px 8px #ffffff4d;
        } #result1:hover {
            box-shadow: 6px 6px 12px #0000003d, 
                        -4px -4px 8px #ffffff3d;
        }

        #result2 {
            width: 50vw;
            margin-top: 16px;
            padding: 16px;
            background: #fafafa;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 4px 4px 8px #0000004d, 
                        -4px -4px 8px #ffffff4d;
        } #result2:hover {
            box-shadow: 6px 6px 12px #0000003d, 
                        -4px -4px 8px #ffffff3d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="dataForm"> <div class="block">
            <label for="la">双车模型</label>
            <label for="la">输出格式：前车驾驶员责任，前车开发商责任，后车驾驶员责任，后车开发商责任，皆为百分比。如果输出NA则说明情况不存在。</label>
        </div>
            <div class="block">
                <label for="la">前车的自动驾驶等级（L0-L5）:</label>
                <input type="text" id="la" name="la">
            </div>
            <div class="block">
                <label for="lb">后车的自动驾驶等级（L0-L5）:</label>
                <input type="text" id="lb" name="lb">
            </div>
            <div class="block">
                <label for="waya">前车的行为:</label>
                <select name="waya" id="waya">
                    <option value="1">左转</option>
                    <option value="2">右转</option>
                    <option value="3">调头</option>
                    <option value="4">变道</option>
                    <option value="5">直行</option>
                </select>
            </div>
            <div class="block">
                <label for="wayb">后车的行为:</label>
                <select name="wayb" id="wayb">
                    <option value="1">左转</option>
                    <option value="2">右转</option>
                    <option value="3">调头</option>
                    <option value="4">变道</option>
                    <option value="5">直行</option>
                    <option value="6">超车</option>
                </select>
            </div>
            <button type="button" onclick="submitData()">Submit</button>
        </div>
        <div id="result">Result:</div>
    </div>

    <div class="container">
        <div id="dataForm"> <div class="block">
            <label for="la">车人模型</label>
            <label for="level">输出格式：车驾驶员责任，车开发商责任，行人责任，皆为百分比。如果输出NA则说明情况不存在。</levelbel>
        </div>
            <div class="block">
                <label for="level">车的自动驾驶等级（L0-L5）:</label>
                <input type="text" id="level" name="level">
            </div>
            <div class="block">
                <label for="wayc">车的行为:</label>
                <select name="wayc" id="wayc">
                    <option value="1">超速</option>
                    <option value="2">闯红灯</option>
                    <option value="3">酒驾</option>
                    <option value="4">车辆失控</option>
                    <option value="5">无违法行为</option>
                </select>
            </div>
            <div class="block">
                <label for="wayp">行人的行为:</label>
                <select name="wayp" id="wayp">
                    <option value="1">乱穿马路</option>
                    <option value="2">闯红灯</option>
                    <option value="3">无违法行为</option>
                </select>
            </div>
            <button type="button" onclick="submitData1()">Submit</button>
        </div>
        <div id="result1">Result:</div>
    </div>

    <div class="container">
        <div id="dataForm"> <div class="block">
            <label for="la">三车模型</label>
            <label for="la">输出格式：第一辆车驾驶员责任，第一辆车开发商责任，第二辆车驾驶员责任，第二辆车开发商责任，第三辆车驾驶员责任，第三辆车开发商责任，皆为百分比。如果输出NA则说明情况不存在。</label>
        </div>
            <div class="block">
                <label for="lx">第一辆车的自动驾驶等级（L0-L5）:</label>
                <input type="text" id="lx" name="lx">
            </div>
            <div class="block">
                <label for="ly">第二辆车的自动驾驶等级（L0-L5）:</label>
                <input type="text" id="ly" name="ly">
            </div>
            <div class="block">
                <label for="lz">第三辆车的自动驾驶等级（L0-L5）:</label>
                <input type="text" id="lz" name="lz">
            </div>
            <div class="block">
                <label for="wayx">第一辆车的行为:</label>
                <select name="wayx" id="wayx">
                    <option value="1">左转</option>
                    <option value="2">右转</option>
                    <option value="3">调头</option>
                    <option value="4">变道</option>
                    <option value="5">直行</option>
                </select>
            </div>
            <div class="block">
                <label for="wayy">第二辆车的行为:</label>
                <select name="wayy" id="wayy">
                    <option value="1">左转</option>
                    <option value="2">右转</option>
                    <option value="3">调头</option>
                    <option value="4">变道</option>
                    <option value="5">直行</option>
                </select>
            </div>
            <div class="block">
                <label for="wayz">第三辆车的行为:</label>
                <select name="wayz" id="wayz">
                    <option value="1">左转</option>
                    <option value="2">右转</option>
                    <option value="3">调头</option>
                    <option value="4">变道</option>
                    <option value="5">直行</option>
                </select>
            </div>
            <button type="button" onclick="submitData2()">Submit</button>
        </div>
        <div id="result2">Result:</div>
    </div>

    <script>
        // define a function to fetch and parse CSV file.
        // You can just ignore it. 
        async function fetchAndParseCSV(url) {
            try {
                const response = await fetch(url);
                const csvData = await response.text();
                const rows = csvData.split('\n');
                const dataSets = [];

                // Assuming the first row contains headers
                const headers = rows[0].split(',');

                // Start from the second row to parse actual data
                for (let i = 1; i < rows.length; i++) {
                    const cells = rows[i].split(',');
                    if (cells.length === headers.length) {
                        const dataSet = {};
                        for (let j = 0; j < headers.length; j++) {
                            dataSet[headers[j].trim()] = cells[j].trim();
                        }
                        dataSets.push(dataSet);
                    }
                }
                return dataSets;
            } catch (error) {
                console.error('Error fetching or parsing CSV file:', error);
                return null;
            }
        }
        async function fetchAndParseCSV1(url) {
            try {
                const response = await fetch(url);
                const csvData = await response.text();
                const rows = csvData.split('\n');
                const dataSets = [];

                // Assuming the first row contains headers
                const headers = rows[0].split(',');

                // Start from the second row to parse actual data
                for (let i = 1; i < rows.length; i++) {
                    const cells = rows[i].split(',');
                    if (cells.length === headers.length) {
                        const dataSet = {};
                        for (let j = 0; j < headers.length; j++) {
                            dataSet[headers[j].trim()] = cells[j].trim();
                        }
                        dataSets.push(dataSet);
                    }
                }
                return dataSets;
            } catch (error) {
                console.error('Error fetching or parsing CSV file:', error);
                return null;
            }
        }
        // Call the function to fetch and parse CSV file
        let ds;
        fetchAndParseCSV('dataset.csv')
            .then(dataSets => {
                if (dataSets) {
                    // console.log('Parsed data sets:', dataSets);
                    ds = dataSets;
                } else {
                    console.error('Failed to fetch or parse CSV file.');
                }
            });

        function find_res(way_a, way_b) {
            let result = ds.filter(row => row['WayA'] === way_a && row['WayB'] === way_b);
            if (result.length > 0) {
                return [result[0]['ResA'], result[0]['ResB']];
            } else {
                return ['NA', 'NA'];
            }
        }

        function search_res(way_a, way_b) {
            let [res_a, res_b] = find_res(way_a, way_b);
            return [res_a, res_b];
        }

        function sigmoid(num) {
            return 1 / (1 + Math.exp(-num));
        }

        const level_res = [0.0, Math.ceil(sigmoid(-3) * 100), 30.0, 72.0, Math.ceil(sigmoid(3) * 100), 100.0];

        function final_res(la, lb, ra, rb) {
            let fa = ra * (100 - level_res[la]);
            let fac = ra * level_res[la];
            let fb = rb * (100 - level_res[lb]);
            let fbc = rb * level_res[lb];
            return [fa, fac, fb, fbc];
        }

        function one4all(la, lb, waya, wayb) {
            let [ra, rb] = search_res(waya, wayb);
            return final_res(la, lb, ra, rb);
        }

        function submitData() {
            let la = document.getElementById('la').value;
            let lb = document.getElementById('lb').value;
            let ra = document.getElementById('waya').value;
            let rb = document.getElementById('wayb').value;
            let [result1, result2, result3, result4] = one4all(la, lb, ra, rb);
            document.getElementById('result').innerHTML = `Result: ${result1}, ${result2}, ${result3}, ${result4}`;
        }
        
        let ds1;
        fetchAndParseCSV1('dataset1.CSV')
            .then(dataSets1 => {
                if (dataSets1) {
                    // console.log('Parsed data sets:', dataSets);
                    ds1 = dataSets1;
                } else {
                    console.error('Failed to fetch or parse CSV file.');
                }
            });

        function find_res1(way_c, way_p) {
            let result = ds1.filter(row => row['Car'] === way_c && row['Pass'] === way_p);
            if (result.length > 0) {
                return [result[0]['Car_Res'], result[0]['Pass_Res']];
            } else {
                return ['NA', 'NA'];
            }
        }

        function search_res1(way_a, way_b) {
            let [res_a, res_b] = find_res1(way_a, way_b);
            return [res_a, res_b];
        }

        function final_res1(level, ra, rb) {
            let fa = Math.round(ra * (100 - level_res[level]));
            let fac = Math.round(ra * level_res[level]);
            let fb = Math.round(rb * 100);
            return [fa, fac, fb];
        }

        function one4all1(level, wayc, wayp) {
            let [ra, rb] = search_res1(wayc, wayp);
            return final_res1(level, ra, rb);
        }

        function submitData1() {
            let level = document.getElementById('level').value;
            let ra = document.getElementById('wayc').value;
            let rb = document.getElementById('wayp').value;
            let [result1, result2, result3] = one4all1(level, ra, rb);
            document.getElementById('result1').innerHTML = `Result: ${result1}, ${result2}, ${result3}`;
        }

        let ds2;
        fetchAndParseCSV('dataset2.CSV')
            .then(dataSets2 => {
                if (dataSets2) {
                    // console.log('Parsed data sets:', dataSets);
                    ds2 = dataSets2;
                } else {
                    console.error('Failed to fetch or parse CSV file.');
                }
            });

        function find_res2(way_x, way_y, way_z) {
            let result = ds2.filter(row => row['WayX'] === way_x && row['WayY'] === way_y && row['WayZ'] === way_z);
            if (result.length > 0) {
                return [result[0]['fRes_X'], result[0]['fRes_Y'], result[0]['fRes_Z']];
            } else {
                return ['NA', 'NA'];
            }
        }

        function search_res2(way_x, way_y, way_z) {
            let [res_x, res_y, res_z] = find_res2(way_x, way_y, way_z);
            return [res_x, res_y, res_z];
        }
        function final_res2(lx, ly, lz, rx, ry, rz) {
            let tmpx = rx * (100 - level_res[lx]);
            let tmpxc = rx * level_res[lx];
            let tmpy = ry * (100 - level_res[ly]);
            let tmpyc = ry * level_res[ly];
            let tmpz = rz * (100 - level_res[lz]);
            let tmpzc = rz * level_res[lz];
            let fx = parseFloat(tmpx.toFixed(1));
            let fxc = parseFloat(tmpxc.toFixed(1));
            let fy = parseFloat(tmpy.toFixed(1));
            let fyc = parseFloat(tmpyc.toFixed(1));
            let fz = parseFloat(tmpz.toFixed(1));
            let fzc = parseFloat(tmpzc.toFixed(1));
            return [fx, fxc, fy, fyc, fz, fzc];
        }

        function one4all2(lx, ly, lz, wayx, wayy, wayz) {
            let [rx, ry, rz] = search_res2(wayx, wayy, wayz);
            return final_res2(lx, ly, lz, rx, ry, rz);
        }

        function submitData2() {
            let lx = document.getElementById('lx').value;
            let ly = document.getElementById('ly').value;
            let lz = document.getElementById('lz').value;
            let rx = document.getElementById('wayx').value;
            let ry = document.getElementById('wayy').value;
            let rz = document.getElementById('wayz').value;
            let [result1, result2, result3, result4, result5, result6] = one4all2(lx, ly, lz, rx, ry, rz);
            document.getElementById('result2').innerHTML = `Result: ${result1}, ${result2}, ${result3}, ${result4}, ${result5}, ${result6}`;
        }
    </script>
</body>
</html>
